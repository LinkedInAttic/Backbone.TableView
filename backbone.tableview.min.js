(function(){var e=function(a,b){return function(){return a.apply(b,arguments)}},u={}.hasOwnProperty,g=function(a,b){function d(){this.constructor=a}for(var c in b)u.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype;a.prototype=new d;a.__super__=b.prototype;return a},r=[].slice,f=Backbone,c=function(){this.onUpdated=e(this.onUpdated,this);this.onUpdating=e(this.onUpdating,this);this.showLoading=e(this.showLoading,this);this.render=e(this.render,this);this.toggleSort=e(this.toggleSort,this);this.nextPage=
e(this.nextPage,this);this.prevPage=e(this.prevPage,this);this.toPage=e(this.toPage,this);this.renderData=e(this.renderData,this);this.refreshPagination=e(this.refreshPagination,this);this.update=e(this.update,this);this.updateUrl=e(this.updateUrl,this);this.updateSearch=e(this.updateSearch,this);this.createFilter=e(this.createFilter,this);this.setData=e(this.setData,this);return c.__super__.constructor.apply(this,arguments)};g(c,Backbone.View);c.prototype.tagName="div";c.prototype.titleTemplate=
_.template('<div class="<%= classSize %>">\n    <h4 class="<%= model.className || "" %>"><%= model.name || model %></h4>\n</div>');c.prototype.filtersTemplate=_.template('<div class="filters controls tableview-center <%= classSize %>">\n</div>');c.prototype.searchTemplate=_.template('<div class="<%= classSize %>">\n    <input type="text" class="search-query input-block-level pull-right" placeholder="<%= model.detail || model %>" value="<%- data[model.query || "q"] || "" %>"></input>\n</div>');c.prototype.paginationTemplate=
_.template('<div class="row-fluid">\n    <div class="span6">\n        <div class="tableview-info">Showing <%= from %> to <%= to %><%= total %></div>\n    </div>\n    <div class="span6">\n        <div class="pagination tableview-pagination">\n            <ul>\n                <li class="pager-prev <%= prevDisabled %>"><a href="javascript:void(0)">\u2190 Previous</a></li>\n                <% _.each(pages, function (page) { %>\n                    <li class="pager-page <%= page.active %>"><a href="javascript:void(0)"><%= page.number %></a></li>\n                <% }) %>\n                <li class="pager-next <%= nextDisabled %>"><a href="javascript:void(0)">Next \u2192 </a></li>\n            </ul>\n        </div>\n    </div>\n</div>');
c.prototype.emptyTemplate=_.template('<tr>\n    <td colspan="10"><span class="<%= className %>"><%= text %></span></td>\n</tr>');c.prototype.columnsTemplate=_.template('<% _.each(model, function (col, key) { %>\n    <th abbr="<%= key || col %>"\n     class="<%= !col.nosort ? "tableview-sorting" : "" %> <%= ((key || col) == data.sort_col) ? "tableview-sorting-" + data.sort_dir : "" %> <%= col.className || "" %>">\n        <%= col.header || key %>\n    </th>\n<% }) %>');c.prototype.template=_.template('<div class="tableview-container">\n    <div class="loading hide">\n        <span class="tableview-loading-spinner">Loading...</span>\n    </div>\n    <div class="row-fluid">\n        <%= title %>\n\n        <%= filters %>\n\n        <%= search %>\n    </div>\n\n    <table class="table table-striped tableview-table">\n        <thead>\n            <tr>\n                <%= columns %>\n            </tr>\n        </thead>\n        <tbody class="fade">\n        </tbody>\n    </table>\n\n    <div id="pagination-main">\n    </div>\n</div>');
c.prototype.myEvents={"change .search-query":"updateSearch","click  th":"toggleSort","click  .pager-page:not(.active)":"toPage","click  .pager-prev:not(.disabled)":"prevPage","click  .pager-next:not(.disabled)":"nextPage"};c.prototype.initialize=function(){var a,b,d,c,p;this.events=_.extend(_.clone(this.myEvents),this.events);this.collection.on("reset",this.renderData);this.collection.on("add",this.renderData);this.collection.on("remove",this.renderData);this.collection.on("destroy",this.renderData);
this.on("updating",this.onUpdating);this.on("updated",this.onUpdated);d=this.options;for(a in d)b=d[a],this[a]=b;this.data=_.extend({},this.initialData);this.router&&(this.data=_.extend(this.data,this.parseQueryString(Backbone.history.fragment)));this.pagination&&(this.data.page=null!=(c=parseInt(this.data.page)||this.page)?c:1,this.data.size=null!=(p=parseInt(this.data.size)||this.size)?p:10);return this};c.prototype.parseQueryString=function(a){var b,d,c,p;c={};if(a&&0<=(b=a.indexOf("?"))){a=a.substring(b+
1);p=/([^&=]+)=?([^&]*)/g;for(b=function(a){return decodeURIComponent(a.replace(/\+/g," "))};d=p.exec(a);)c[b(d[1])]=b(d[2])}return c};c.prototype.setData=function(){var a,b,d;a=1<=arguments.length?r.call(arguments,0):[];this.pagination&&(this.data.page=1);for(;1<a.length;)b=a[0],d=a[1],a=3<=a.length?r.call(a,2):[],null!=d?this.data[b]=d:delete this.data[b];return this.update()};c.prototype.createFilter=function(a,b){var d,c,p,e,f,q,s,h,g,j,k,l,m,n,r,t;d={id:a,extraId:b.extraId,name:null!=(c=b.name)?
c:this.prettyName(a),off:null!=(p=b.off)?p:"false",on:null!=(g=b.on)?g:"true",filterClass:null!=(j=b.className)?j:"",options:b.options,init:(null!=(r=b.set)?r:_.identity)(null!=(k=null!=(l=this.data[a])?l:b.init)?k:"",null!=(m=null!=(n=this.data[b.extraId])?n:b.extraInit)?m:""),setData:this.setData,get:null!=(t=b.get)?t:_.identity,getExtraId:null!=(e=b.getExtraId)?e:_.identity};switch(b.type){case "option":return new Backbone.TableView.ButtonOptionFilter(d);case "dropdown":return new Backbone.TableView.DropdownFilter(d);
case "input":return new Backbone.TableView.InputFilter(d);case "button":return d.init||(d.init=null!=(f=b.off)?f:"false"),new Backbone.TableView.ButtonFilter(d);case "buttongroup":return new Backbone.TableView.ButtonGroupFilter(d);case "custom":return b.setData=this.setData,b.init=(null!=(h=b.set)?h:_.identity)(null!=(q=null!=(s=this.data[a])?s:b.init)?q:""),b}};c.prototype.updateSearch=function(a){return this.setData(this.search.query||"q",a.currentTarget.value)};c.prototype.updateUrl=function(a){var b,
d;if(this.router){d=Backbone.history.fragment;if(0<=(b=d.indexOf("?")))d=d.substring(0,b);(b=$.param(this.data))&&(d+="?"+b);this.router.navigate(d,{replace:a})}return this};c.prototype.update=function(a,b){this.trigger("updating");this.updateUrl(a);b?this.renderData():this.noFetch||this.collection.fetch({data:("function"===typeof this.filterData?this.filterData(_.clone(this.data)):void 0)||this.data});return this};c.prototype.refreshPagination=function(){var a,b,d,c,e,f;this.data.page=parseInt("function"===
typeof(a=this.collection).getData?a.getData("page"):void 0)||this.data.page;this.data.size=parseInt("function"===typeof(d=this.collection).getData?d.getData("size"):void 0)||this.data.size;a=(this.data.page-1)*this.data.size;f=a+this.collection.size();0<this.collection.size()&&a++;d=null!=this.collection.count?_.result(this.collection,"count"):-1;0>d?(e=b=this.data.page,c=""):(c=Math.ceil(d/this.data.size)||1,b=_.max([1,this.data.page-2-_.max([0,2+this.data.page-c])]),e=_.min([c,this.data.page+2+
_.max([0,3-this.data.page])]),c=" of "+d+" entries");var h,q,g;q=_.range(b,e+1);g=[];e=0;for(h=q.length;e<h;e++)b=q[e],g.push({number:b,active:b===this.data.page&&"active"||""});this.$("#pagination-main").html(this.paginationTemplate({from:a,to:f,total:c,prevDisabled:1===this.data.page?"disabled":"",nextDisabled:f===d?"disabled":"",pages:g}));return this};c.prototype.renderData=function(){var a,b,d,c,e,f,g,h,j,k,l,m;a=this.$("tbody");if(0===this.collection.models.length)a.html(this.emptyTemplate({text:null!=
(b=this.empty)?b:"No records to show",className:""}));else{a.html("");j=this.collection.models;g=0;for(h=j.length;g<h;g++){c=j[g];f=$("<tr>");k=this.columns;for(e in k)d=k[e],b=$("<td>").addClass(d.className).addClass(d.tdClass),null!=d.draw?b.html(d.draw(c,this)):b.text(null!=(l=c.get(e))?l:""),f.append(b);a.append(null!=(m="function"===typeof this.rowTransformer?this.rowTransformer(f,c):void 0)?m:f)}}this.pagination&&this.refreshPagination();this.trigger("updated");return this};c.prototype.toPage=
function(a){return this.setData("page",parseInt(a.currentTarget.childNodes[0].text))};c.prototype.prevPage=function(){if(1<this.data.page)return this.setData("page",this.data.page-1)};c.prototype.nextPage=function(){return this.setData("page",this.data.page+1)};c.prototype.toggleSort=function(a){var b;a=a.currentTarget;b=a.className;if(0<=b.indexOf("tableview-sorting-asc"))b="desc";else if(0<=b.indexOf("tableview-sorting"))b="asc";else return this;this.$("th").removeClass("tableview-sorting-desc tableview-sorting-asc");
this.$(a).addClass("tableview-sorting-"+b);return this.setData("sort_col",a.abbr,"sort_dir",b)};c.prototype.applyTemplate=function(a,b,d){null==d&&(d=12);return b&&d&&a({data:this.data,model:b,classSize:"span"+d})||""};c.prototype.render=function(){var a,b,d,c,e,f=this;d=3;a=6;b=3;null==this.search&&(a+=b,b=0);null==this.title?(a+=d,d=0):null==this.filters&&(d+=a,a=0);this.$el.html(this.template({title:this.applyTemplate(this.titleTemplate,this.title,d),search:this.applyTemplate(this.searchTemplate,
this.search,b),filters:this.applyTemplate(this.filtersTemplate,this.filters,a),columns:this.applyTemplate(this.columnsTemplate,this.columns)}));b=_.compact(_.map(this.filters,function(a,b){return f.createFilter(b,a)}));d=this.$(".filters");c=0;for(e=b.length;c<e;c++)a=b[c],d.append(a.render().el);return this.update(!0,this.skipInitialFetch)};c.prototype.prettyName=function(a){return a.charAt(0).toUpperCase()+a.substring(1).replace(/_(\w)/g,function(a,d){return" "+d.toUpperCase()})};c.prototype.showLoading=
function(){this.showLoadingTimeout=null;this.$("tbody").removeClass("in");return 0===this.collection.models.length?(this.$(".loading").addClass("hide"),this.$("tbody").html(this.emptyTemplate({text:"Loading...",className:"tableview-loading-spinner"}))):this.$(".loading").removeClass("hide")};c.prototype.onUpdating=function(){this.showLoadingTimeout&&clearTimeout(this.showLoadingTimeout);return this.showLoadingTimeout=_.delay(this.showLoading,500)};c.prototype.onUpdated=function(){this.showLoadingTimeout&&
clearTimeout(this.showLoadingTimeout);this.$("tbody").addClass("in");return this.$(".loading").addClass("hide")};f.TableView=c;var f=Backbone.TableView,j=function(){this.render=e(this.render,this);return j.__super__.constructor.apply(this,arguments)};g(j,Backbone.View);j.prototype.tagName="div";j.prototype.className="pull-left tableview-filterbox";j.prototype.initialize=function(){this.id=this.options.id;this.extraId=this.options.extraId;this.setData=this.options.setData;return this.options.options=
_.map(_.result(this.options,"options"),function(a){_.isArray(a)?a={name:a[0],value:a[1]}:_.isObject(a)||(a={name:a,value:a});return a})};j.prototype.render=function(){this.$el.html(this.template(this.options));return this};f.Filter=j;var f=Backbone.TableView,k=function(){this.update=e(this.update,this);return k.__super__.constructor.apply(this,arguments)};g(k,Backbone.TableView.Filter);k.prototype.template=_.template('<span class="add-on"><%= name %></span><input type="text" class="filter <%= filterClass %>" value="<%= init %>"></input>');
k.prototype.className="input-prepend pull-left tableview-filterbox";k.prototype.events={"change .filter":"update"};k.prototype.update=function(a){return this.extraId?this.setData(this.id,this.options.get(a.currentTarget.value),this.extraId,this.options.getExtraId(a.currentTarget.value)):this.setData(this.id,this.options.get(a.currentTarget.value))};f.InputFilter=k;var f=Backbone.TableView,h=function(){this.update=e(this.update,this);return h.__super__.constructor.apply(this,arguments)};g(h,Backbone.TableView.Filter);
h.prototype.template=_.template('<button type="button" class="filter btn <%= init == on ? "active" : "" %> <%= filterClass %>"><%= name %></button>');h.prototype.events={"click .filter":"update"};h.prototype.initialize=function(){h.__super__.initialize.apply(this,arguments);this.values=[this.options.off,this.options.on];return this.current=this.options.init===this.options.off?0:1};h.prototype.update=function(a){this.$(a.currentTarget).toggleClass("active");this.current=1-this.current;return this.setData(this.id,
this.values[this.current])};f.ButtonFilter=h;var f=Backbone.TableView,l=function(){this.update=e(this.update,this);return l.__super__.constructor.apply(this,arguments)};g(l,Backbone.TableView.Filter);l.prototype.template=_.template('<% _.each(options, function (el, i) { %>\n    <button class="btn <%= _.contains(init, el.value) ? "active" : "" %> <%= !_.isUndefined(el.className) ? el.className : "" %>" value="<%= el.value %>"><%= el.name %></button>\n<% }) %>');l.prototype.className="btn-group pull-left tableview-filterbox";
l.prototype.events={"click .btn":"update"};l.prototype.update=function(a){var b=this;this.$(a.currentTarget).toggleClass("active");a=_.compact(_.map(this.$(".btn"),function(a){return b.$(a).hasClass("active")?b.$(a).attr("value"):null}));return this.setData(this.id,this.options.get(a))};f.ButtonGroupFilter=l;var f=Backbone.TableView,m=function(){this.update=e(this.update,this);return m.__super__.constructor.apply(this,arguments)};g(m,Backbone.TableView.Filter);m.prototype.template=_.template('<% _.each(options, function (el, i) { %>\n    <button class="btn <%= init == el.value ? "active" : "" %>" value="<%= el.value %>"><%= el.name %></button>\n<% }) %>');
m.prototype.className="btn-group pull-left tableview-filterbox";m.prototype.events={"click .btn":"update"};m.prototype.update=function(a){this.$(".btn").removeClass("active");this.$(a.currentTarget).addClass("active");return this.setData(this.id,a.currentTarget.value)};f.ButtonOptionFilter=m;var f=Backbone.TableView,n=function(){this.update=e(this.update,this);return n.__super__.constructor.apply(this,arguments)};g(n,Backbone.TableView.Filter);n.prototype.template=_.template('<select class="filter <%= filterClass %>">\n    <% _.each(options, function (el, i) { %>\n        <option <%= init == el.value ? "selected=\'selected\'" : "" %> value="<%= el.value %>"><%= el.name %></button>\n    <% }) %>\n</select>');
n.prototype.events={"change .filter":"update"};n.prototype.update=function(a){return this.setData(this.id,a.currentTarget.value)};f.DropdownFilter=n}).call(this);
