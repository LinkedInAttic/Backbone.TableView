var ButtonFilter,Filter,InputFilter,__bind=function(c,a){return function(){return c.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(c,a){function d(){this.constructor=c}for(var b in a)__hasProp.call(a,b)&&(c[b]=a[b]);d.prototype=a.prototype;c.prototype=new d;c.__super__=a.prototype;return c};
Backbone.TableView=function(c){function a(){this.render=__bind(this.render,this);this.toggleSort=__bind(this.toggleSort,this);this.nextPage=__bind(this.nextPage,this);this.prevPage=__bind(this.prevPage,this);this.renderData=__bind(this.renderData,this);this.update=__bind(this.update,this);this.updateSearchOnEnter=__bind(this.updateSearchOnEnter,this);this.createFilter=__bind(this.createFilter,this);this.setData=__bind(this.setData,this);return a.__super__.constructor.apply(this,arguments)}__extends(a,
c);a.prototype.tagName="div";a.prototype.titleTemplate=_.template("<h2><%= model %></h2>");a.prototype.searchTemplate=_.template('<input type="text" class="search-query pull-right" placeholder="<%= model.detail || model %>"></input>');a.prototype.paginationTemplate=_.template('<ul class="pager">\n    <li class="pager-prev">\n        <a href="javascript:void(0)">&larr; Prev</a>\n    </li>\n    <span class="badge badge-info page">1</span>\n    <li class="pager-next">\n        <a href="javascript:void(0)">Next &rarr;</a>\n    </li>\n</ul>');
a.prototype.dataTemplate=_.template('<% _.each(collection.models, function (row) { %>\n    <tr>\n        <% _.each(columns, function (col, name) { %>\n            <td class="<%= col.className || "" %>">\n                <%= col.draw ? col.draw(row) : row.get(name) %>\n            </td>\n        <% }) %>\n    </tr>\n<% }) %>\n<% if (collection.models.length == 0) { %>\n    <tr>\n        <td colspan="10"><%= empty %></td>\n    </tr>\n<% } %>');a.prototype.template=_.template('<div class="row-fluid">\n    <div class="span2">\n        <%= title %>\n    </div>\n\n    <div class="filters controls pagination-centered span8">\n    </div>\n\n    <div class="span2">\n        <%= search %>\n    </div>\n</div>\n\n<table class="table table-striped table-bordered">\n    <thead>\n        <tr>\n            <% _.each(columns, function (col, key) { %>\n                <th abbr="<%= key || col %>" class="<%= !col.nosort && "sorting" %> <%= col.className || "" %>">\n                    <%= col.header || col %>\n                </th>\n            <% }) %>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td colspan="10"><%= empty %></td>\n        </tr>\n    </tbody>\n</table>\n\n<%= pagination %>');
a.prototype.events={"keypress .search-query":"updateSearchOnEnter","click    .pager-prev":"prevPage","click    .pager-next":"nextPage","click    th":"toggleSort"};a.prototype.initialize=function(){this.collection.on("reset",this.renderData);this.data=this.options.initialData||this.initialData||{};this.data.page=this.options.page||this.page||1;this.data.size=this.options.size||this.size||10;return this};a.prototype.setData=function(a,b){this.data[a]=b;return this.update()};a.prototype.createFilter=
function(a,b){switch(b.type){case "button":return new ButtonFilter({id:a,init:b.init||"false",toggle:b.toggle||"true",filterClass:b.className||"",setData:this.setData});case "input":return new InputFilter({id:a,init:b.init||"",className:"input-prepend inline",filterClass:b.className||"",get:b.get||_.identity,setData:this.setData})}b.setData=this.setData;return b};a.prototype.updateSearchOnEnter=function(a){13===a.keyCode&&((a=a.currentTarget.value)?this.data[this.search.query||"q"]=a:delete this.data[this.search.query||
"q"],this.update());return this};a.prototype.update=function(){this.collection.fetch({data:this.data});return this};a.prototype.renderData=function(){$("tbody",this.$el).html(this.dataTemplate({collection:this.collection,columns:this.columns,empty:this.empty||"No records to show"}));return this};a.prototype.prevPage=function(){if(1<this.data.page)return this.data.page-=1,$(".page",this.$el).html(this.data.page),this.update()};a.prototype.nextPage=function(){if(this.collection.length===this.data.size)return this.data.page+=
1,$(".page",this.$el).html(this.data.page),this.update()};a.prototype.toggleSort=function(a){var b;b=a.currentTarget;a=b.className;if(0<=a.indexOf("sorting_desc"))this.data.sort_dir="asc",a="sorting_asc";else if(0<=a.indexOf("sorting")||0<=a.indexOf("sorting_asc"))this.data.sort_dir="desc",a="sorting_desc";else return this;$("th.sorting_desc, th.sorting_asc",this.$el).removeClass("sorting_desc sorting_asc");$(b,this.$el).addClass(a);this.data.sort_col=b.abbr;return this.update()};a.prototype.applyTemplate=
function(a,b){return b&&a({model:b})||""};a.prototype.render=function(){var a,b=this;this.$el.html(this.template({columns:this.columns,empty:this.empty||"",title:this.applyTemplate(this.titleTemplate,this.title),search:this.applyTemplate(this.searchTemplate,this.search),pagination:this.applyTemplate(this.paginationTemplate,this.pagination)}));this.filters=_.map(this.filters,function(a,c){return b.createFilter(c,a)});a=$(".filters",this.$el);_.each(this.filters,function(b){a.append(b.render().el);
return a.append(" ")});return this.update()};return a}(Backbone.View);
Filter=function(c){function a(){this.render=__bind(this.render,this);return a.__super__.constructor.apply(this,arguments)}__extends(a,c);a.prototype.tagName="div";a.prototype.className="inline";a.prototype.initialize=function(){this.id=this.options.id;return this.setData=this.options.setData};a.prototype.prettyName=function(a){return a.charAt(0).toUpperCase()+a.substring(1).replace(/_(\w)/g,function(a,c){return" "+c.toUpperCase()})};a.prototype.render=function(){this.options.name=this.prettyName(this.id);
this.$el.html(this.template(this.options));return this};return a}(Backbone.View);
InputFilter=function(c){function a(){this.update=__bind(this.update,this);return a.__super__.constructor.apply(this,arguments)}__extends(a,c);a.prototype.template=_.template('<span class="add-on"><%= name %></span><input type="text" class="filter <%= filterClass %>" value="<%= init %>"></input>');a.prototype.events={"change .filter":"update"};a.prototype.update=function(a){return this.setData(this.id,this.options.get(a.currentTarget.value))};return a}(Filter);
ButtonFilter=function(c){function a(){this.update=__bind(this.update,this);return a.__super__.constructor.apply(this,arguments)}__extends(a,c);a.prototype.template=_.template('<button type="button" class="filter btn <%= filterClass %>" data-toggle="button"><%= name %></button>');a.prototype.events={"click .filter":"update"};a.prototype.initialize=function(){a.__super__.initialize.apply(this,arguments);this.values=[this.options.init,this.options.toggle];return this.current=0};a.prototype.update=function(){this.current=
1-this.current;return this.setData(this.id,this.values[this.current])};return a}(Filter);
