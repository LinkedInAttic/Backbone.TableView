var ButtonFilter,ButtonOptionFilter,Filter,InputFilter,__bind=function(d,a){return function(){return d.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(d,a){function e(){this.constructor=d}for(var b in a)__hasProp.call(a,b)&&(d[b]=a[b]);e.prototype=a.prototype;d.prototype=new e;d.__super__=a.prototype;return d},__slice=[].slice;
Backbone.TableView=function(d){function a(){this.render=__bind(this.render,this);this.toggleSort=__bind(this.toggleSort,this);this.nextPage=__bind(this.nextPage,this);this.prevPage=__bind(this.prevPage,this);this.toPage=__bind(this.toPage,this);this.renderData=__bind(this.renderData,this);this.refreshPagination=__bind(this.refreshPagination,this);this.update=__bind(this.update,this);this.updateUrl=__bind(this.updateUrl,this);this.updateSearch=__bind(this.updateSearch,this);this.createFilter=__bind(this.createFilter,
this);this.setData=__bind(this.setData,this);return a.__super__.constructor.apply(this,arguments)}__extends(a,d);a.prototype.tagName="div";a.prototype.titleTemplate=_.template('<div class="<%= classSize %>">\n    <h4 class="<%= model.className || "" %>"><%= model.name || model %></h4>\n</div>');a.prototype.filtersTemplate=_.template('<div class="filters controls pagination-centered <%= classSize %>">\n</div>');a.prototype.searchTemplate=_.template('<div class="<%= classSize %>">\n    <input type="text" class="search-query input-block-level pull-right" placeholder="<%= model.detail || model %>" value="<%- data[model.query || "q"] || "" %>"></input>\n</div>');
a.prototype.paginationTemplate=_.template('<div class="row-fluid">\n    <div class="span6">\n        <div class="tableview-info">Showing <%= from %> to <%= to %><%= total %></div>\n    </div>\n    <div class="span6">\n        <div class="pagination tableview-pagination">\n            <ul>\n                <li class="pager-prev <%= prevDisabled %>"><a href="javascript:void(0)">\u2190 Previous</a></li>\n                <% _.each(pages, function (page) { %>\n                    <li class="pager-page <%= page.active %>"><a href="javascript:void(0)"><%= page.number %></a></li>\n                <% }) %>\n                <li class="pager-next <%= nextDisabled %>"><a href="javascript:void(0)">Next \u2192 </a></li>\n            </ul>\n        </div>\n    </div>\n</div>');
a.prototype.emptyTemplate=_.template('<tr>\n    <td colspan="10"><%= text %></td>\n</tr>');a.prototype.columnsTemplate=_.template('<% _.each(model, function (col, key) { %>\n    <th abbr="<%= key || col %>"\n     class="<%= !col.nosort ? "tableview-sorting" : "" %> <%= ((key || col) == data.sort_col) ? "tableview-sorting-" + data.sort_dir : "" %> <%= col.className || "" %>">\n        <%= col.header || key %>\n    </th>\n<% }) %>');a.prototype.template=_.template('<div class="row-fluid">\n    <%= title %>\n\n    <%= filters %>\n\n    <%= search %>\n</div>\n\n<table class="table table-striped tableview-table">\n    <thead>\n        <tr>\n            <%= columns %>\n        </tr>\n    </thead>\n    <tbody class="fade">\n        <tr>\n            <td colspan="10"><%= empty %></td>\n        </tr>\n    </tbody>\n</table>\n\n<div id="pagination-main">\n</div>');
a.prototype.events={"change .search-query":"updateSearch","click  th":"toggleSort","click  .pager-page:not(.active)":"toPage","click  .pager-prev:not(.disabled)":"prevPage","click  .pager-next:not(.disabled)":"nextPage"};a.prototype.initialize=function(){var e,b,a;this.collection.on("reset",this.renderData);a=this.options;for(e in a)b=a[e],null==this[e]&&(this[e]=b);this.data=_.extend({},this.initialData);this.router&&(this.data=_.extend(this.data,this.parseQueryString(Backbone.history.fragment)));
this.data.page=parseInt(this.data.page)||this.page||1;this.data.size=parseInt(this.data.size)||this.size||10;return this};a.prototype.parseQueryString=function(e){var b,a,g,f;g={};if(e&&0<=(b=e.indexOf("?"))){e=e.substring(b+1);f=/([^&=]+)=?([^&]*)/g;for(b=function(e){return decodeURIComponent(e.replace(/\+/g," "))};a=f.exec(e);)g[b(a[1])]=b(a[2])}return g};a.prototype.setData=function(){var e,b,a;e=1<=arguments.length?__slice.call(arguments,0):[];for(this.data.page=1;1<e.length;)b=e[0],a=e[1],e=
3<=e.length?__slice.call(e,2):[],null!=a&&(!1===a||0===a||a)?this.data[b]=a:delete this.data[b];return this.update()};a.prototype.createFilter=function(e,a){var c,g,f,d,h,j,i,k,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;switch(a.type){case "option":return new ButtonOptionFilter({id:e,name:null!=(c=a.name)?c:this.prettyName(e),filterClass:null!=(g=a.className)?g:"",options:a.options,init:(null!=(x=a.set)?x:_.identity)(null!=(q=null!=(w=this.data[e])?w:a.init)?q:""),setData:this.setData});case "button":return new ButtonFilter({id:e,
name:null!=(y=a.name)?y:this.prettyName(e),off:null!=(z=a.off)?z:"false",on:null!=(A=a.on)?A:"true",filterClass:null!=(B=a.className)?B:"",init:(null!=(h=a.set)?h:_.identity)(null!=(C=null!=(f=null!=(d=this.data[e])?d:a.init)?f:a.off)?C:"false"),setData:this.setData});case "input":return new InputFilter({id:e,name:null!=(j=a.name)?j:this.prettyName(e),extraId:a.extraId,filterClass:null!=(i=a.className)?i:"",get:null!=(k=a.get)?k:_.identity,getExtraId:null!=(m=a.getExtraId)?m:_.identity,init:(null!=
(s=a.set)?s:_.identity)(null!=(n=null!=(o=this.data[e])?o:a.init)?n:"",null!=(p=null!=(r=this.data[a.extraId])?r:a.extraInit)?p:""),setData:this.setData})}a.setData=this.setData;a.init=(null!=(v=a.set)?v:_.identity)(null!=(t=null!=(u=this.data[e])?u:a.init)?t:"");return a};a.prototype.updateSearch=function(a){return this.setData(this.search.query||"q",a.currentTarget.value)};a.prototype.updateUrl=function(a){var b,c,g,f,d,h;if(this.router){f=Backbone.history.fragment;if(0<=(b=f.indexOf("?")))f=f.substring(0,
b);b=!0;h=this.data;for(c in h)d=h[c],b?(b=!1,g="?"):g="&",f=f+g+c+"="+d;this.router.navigate(f,{replace:a})}return this};a.prototype.update=function(a,b){var c;this.$("tbody").removeClass("in");this.trigger("updating");this.updateUrl(a);b?this.renderData():(null!=this.filterData&&(c=this.filterData(_.clone(this.data))),this.collection.fetch({data:c||this.data}));return this};a.prototype.refreshPagination=function(){var a,b,c,g,f,d;a=(this.data.page-1)*this.data.size;d=a+this.collection.size();0<
this.collection.size()&&a++;c=null!=this.collection.count?_.result(this.collection,"count"):-1;0>c?(f=b=this.data.page,g=""):(g=Math.ceil(c/this.data.size)||1,b=_.max([1,this.data.page-2-_.max([0,2+this.data.page-g])]),f=_.min([g,this.data.page+2+_.max([0,3-this.data.page])]),g=" of "+c+" entries");var h,j,i;j=_.range(b,f+1);i=[];f=0;for(h=j.length;f<h;f++)b=j[f],i.push({number:b,active:b===this.data.page&&"active"||""});this.$("#pagination-main").html(this.paginationTemplate({from:a,to:d,total:g,
prevDisabled:1===this.data.page?"disabled":"",nextDisabled:d===c?"disabled":"",pages:i}));return this};a.prototype.renderData=function(){var a,b,c,g,d,l,h,j,i,k;a=this.$("tbody");if(0===this.collection.models.length)a.html(this.emptyTemplate({text:this.empty||"No records to show"}));else{a.html("");i=this.collection.models;h=0;for(j=i.length;h<j;h++){g=i[h];l=$("<tr>");k=this.columns;for(d in k)c=k[d],b=$("<td>").addClass(c.className).addClass(c.tdClass),null!=c.draw?b.html(c.draw(g,this)):b.text(g.get(d)||
""),l.append(b);a.append(l)}}this.pagination&&this.refreshPagination();this.trigger("updated");a.addClass("in");return this};a.prototype.toPage=function(a){return this.setData("page",parseInt(a.currentTarget.childNodes[0].text))};a.prototype.prevPage=function(){if(1<this.data.page)return this.setData("page",this.data.page-1)};a.prototype.nextPage=function(){return this.setData("page",this.data.page+1)};a.prototype.toggleSort=function(a){var b,a=a.currentTarget;b=a.className;if(0<=b.indexOf("tableview-sorting-asc"))b=
"desc";else if(0<=b.indexOf("tableview-sorting"))b="asc";else return this;this.$("th").removeClass("tableview-sorting-desc tableview-sorting-asc");this.$(a).addClass("tableview-sorting-"+b);return this.setData("sort_col",a.abbr,"sort_dir",b)};a.prototype.applyTemplate=function(a,b,c){null==c&&(c=12);return b&&c&&a({data:this.data,model:b,classSize:"span"+c})||""};a.prototype.render=function(){var a,b,c,d,f=this;d=3;a=6;c=3;null==this.search&&(a+=c,c=0);null==this.title?(a+=d,d=0):null==this.filters&&
(d+=a,a=0);this.$el.html(this.template({empty:this.empty||"",title:this.applyTemplate(this.titleTemplate,this.title,d),search:this.applyTemplate(this.searchTemplate,this.search,c),filters:this.applyTemplate(this.filtersTemplate,this.filters,a),columns:this.applyTemplate(this.columnsTemplate,this.columns)}));a=_.map(this.filters,function(a,b){return f.createFilter(b,a)});b=this.$(".filters");_.each(a,function(a){return b.append(a.render().el)});return this.update(!0,this.skipInitialFetch)};a.prototype.prettyName=
function(a){return a.charAt(0).toUpperCase()+a.substring(1).replace(/_(\w)/g,function(a,e){return" "+e.toUpperCase()})};return a}(Backbone.View);
Filter=function(d){function a(){this.render=__bind(this.render,this);return a.__super__.constructor.apply(this,arguments)}__extends(a,d);a.prototype.tagName="div";a.prototype.className="pull-left tableview-filterbox";a.prototype.initialize=function(){this.id=this.options.id;this.extraId=this.options.extraId;return this.setData=this.options.setData};a.prototype.render=function(){this.$el.html(this.template(this.options));return this};return a}(Backbone.View);
InputFilter=function(d){function a(){this.update=__bind(this.update,this);return a.__super__.constructor.apply(this,arguments)}__extends(a,d);a.prototype.template=_.template('<span class="add-on"><%= name %></span><input type="text" class="filter <%= filterClass %>" value="<%= init %>"></input>');a.prototype.className="input-prepend pull-left filterbox";a.prototype.events={"change .filter":"update"};a.prototype.update=function(a){return this.extraId?this.setData(this.id,this.options.get(a.currentTarget.value),
this.extraId,this.options.getExtraId(a.currentTarget.value)):this.setData(this.id,this.options.get(a.currentTarget.value))};return a}(Filter);
ButtonFilter=function(d){function a(){this.update=__bind(this.update,this);return a.__super__.constructor.apply(this,arguments)}__extends(a,d);a.prototype.template=_.template('<button type="button" class="filter btn <%= init == on ? "active" : "" %> <%= filterClass %>"><%= name %></button>');a.prototype.events={"click .filter":"update"};a.prototype.initialize=function(){a.__super__.initialize.apply(this,arguments);this.values=[this.options.off,this.options.on];return this.current=this.options.init===
this.options.off?0:1};a.prototype.update=function(a){this.$(a.currentTarget).toggleClass("active");this.current=1-this.current;return this.setData(this.id,this.values[this.current])};return a}(Filter);
ButtonOptionFilter=function(d){function a(){this.update=__bind(this.update,this);return a.__super__.constructor.apply(this,arguments)}__extends(a,d);a.prototype.template=_.template('<% _.each(options, function (el, i) { %>\n    <button class="btn <%= init == el.value ? "active" : "" %>" value="<%= el.value %>"><%= el.name %></button>\n<% }) %>');a.prototype.className="btn-group pull-left filterbox";a.prototype.events={"click .btn":"update"};a.prototype.initialize=function(){a.__super__.initialize.apply(this,
arguments);return this.options.options=_.map(this.options.options,function(a){var b,c;c=a;_.isArray(c)?(b=c[0],c=c[1]):_.isObject(c)?(b=a.name,c=a.value):b=a;return{name:b,value:c}})};a.prototype.update=function(a){this.$(".btn").removeClass("active");this.$(a.currentTarget).addClass("active");return this.setData(this.id,a.currentTarget.value)};return a}(Filter);
