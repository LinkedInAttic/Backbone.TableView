var ButtonFilter,ButtonOptionFilter,Filter,InputFilter,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function d(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);d.prototype=a.prototype;b.prototype=new d;b.__super__=a.prototype;return b},__slice=[].slice;
Backbone.TableView=function(b){function a(){this.firstOf=__bind(this.firstOf,this);this.render=__bind(this.render,this);this.toggleSort=__bind(this.toggleSort,this);this.nextPage=__bind(this.nextPage,this);this.prevPage=__bind(this.prevPage,this);this.toPage=__bind(this.toPage,this);this.renderData=__bind(this.renderData,this);this.refreshPagination=__bind(this.refreshPagination,this);this.update=__bind(this.update,this);this.updateUrl=__bind(this.updateUrl,this);this.updateSearch=__bind(this.updateSearch,
this);this.createFilter=__bind(this.createFilter,this);this.setData=__bind(this.setData,this);return a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.tagName="div";a.prototype.titleTemplate=_.template('<div class="<%= classSize %>">\n    <h4 class="<%= model.className || "" %>"><%= model.name || model %></h4>\n</div>');a.prototype.filtersTemplate=_.template('<div class="filters controls pagination-centered <%= classSize %>">\n</div>');a.prototype.searchTemplate=_.template('<div class="<%= classSize %>">\n    <input type="text" class="search-query input-block-level pull-right" placeholder="<%= model.detail || model %>" value="<%= data[model.query || "q"] || "" %>"></input>\n</div>');
a.prototype.paginationTemplate=_.template('<div class="row-fluid">\n    <div class="span6">\n        <div class="tableview-info">Showing <%= from %> to <%= to %><%= total %></div>\n    </div>\n    <div class="span6">\n        <div class="pagination">\n            <ul>\n                <li class="pager-prev <%= prevDisabled %>"><a href="javascript:void(0)">\u2190 Previous</a></li>\n                <% _.each(pages, function (page) { %>\n                    <li class="pager-page <%= page.active %>"><a href="javascript:void(0)"><%= page.number %></a></li>\n                <% }) %>\n                <li class="pager-next <%= nextDisabled %>"><a href="javascript:void(0)">Next \u2192 </a></li>\n            </ul>\n        </div>\n    </div>\n</div>');
a.prototype.dataTemplate=_.template('<% _.each(collection.models, function (row) { %>\n    <tr>\n        <% _.each(columns, function (col, name) { %>\n            <td class="<%= col.className || "" %> <%= col.tdClass || "" %>">\n                <%= col.draw ? col.draw(row) : row.get(name) || "" %>\n            </td>\n        <% }) %>\n    </tr>\n<% }) %>\n<% if (collection.models.length == 0) { %>\n    <tr>\n        <td colspan="10"><%= empty %></td>\n    </tr>\n<% } %>');a.prototype.columnsTemplate=
_.template('<% _.each(model, function (col, key) { %>\n    <th abbr="<%= key || col %>"\n     class="<%= !col.nosort && "sorting" %> <%= ((key || col) == data.sort_col) && "sorting_" + data.sort_dir %> <%= col.className || "" %>">\n        <%= col.header || key %>\n    </th>\n<% }) %>');a.prototype.template=_.template('<div class="row-fluid">\n    <%= title %>\n\n    <%= filters %>\n\n    <%= search %>\n</div>\n\n<table class="table table-striped">\n    <thead>\n        <tr>\n            <%= columns %>\n        </tr>\n    </thead>\n    <tbody class="fade">\n        <tr>\n            <td colspan="10"><%= empty %></td>\n        </tr>\n    </tbody>\n</table>\n\n<div id="pagination-main">\n</div>');
a.prototype.events={"change .search-query":"updateSearch","click  th":"toggleSort","click  .pager-page:not(.active)":"toPage","click  .pager-prev:not(.disabled)":"prevPage","click  .pager-next:not(.disabled)":"nextPage"};a.prototype.initialize=function(){var d,c,a;this.collection.on("reset",this.renderData);a=this.options;for(d in a)c=a[d],null==this[d]&&(this[d]=c);this.data=$.extend({},this.initialData,this.parseQueryString(Backbone.history.fragment));this.data.page=parseInt(this.data.page)||this.page||
1;this.data.size=parseInt(this.data.size)||this.size||10;return this};a.prototype.parseQueryString=function(d){var c,a,f,b;f={};if(d&&0<=(c=d.indexOf("?"))){d=d.substring(c+1);b=/([^&=]+)=?([^&]*)/g;for(c=function(d){return decodeURIComponent(d.replace(/\+/g," "))};a=b.exec(d);)f[c(a[1])]=c(a[2])}return f};a.prototype.setData=function(){var d,a,e;d=1<=arguments.length?__slice.call(arguments,0):[];for(this.data.page=1;1<d.length;)a=d[0],e=d[1],d=3<=d.length?__slice.call(d,2):[],null!=e&&(!1===e||0===
e||e)?this.data[a]=e:delete this.data[a];return this.update()};a.prototype.createFilter=function(d,a){switch(a.type){case "option":return new ButtonOptionFilter({id:d,name:a.name||this.prettyName(d),filterClass:a.className||"",options:a.options,init:(a.set||_.identity)(this.data[d]||a.init||""),setData:this.setData});case "button":return new ButtonFilter({id:d,name:a.name||this.prettyName(d),off:this.firstOf(a.off,"false"),on:this.firstOf(a.on,"true"),filterClass:a.className||"",init:(a.set||_.identity)(this.firstOf(this.data[d],
a.init,a.off,"false")),setData:this.setData});case "input":return new InputFilter({id:d,name:a.name||this.prettyName(d),extraId:a.extraId,filterClass:a.className||"",get:a.get||_.identity,getExtraId:a.getExtraId||_.identity,init:(a.set||_.identity)(this.data[d]||a.init||"",this.data[a.extraId]||a.extraInit||""),setData:this.setData})}a.setData=this.setData;a.init=(a.set||_.identity)(this.data[d]||a.init||"");return a};a.prototype.updateSearch=function(a){return this.setData(this.search.query||"q",
a.currentTarget.value)};a.prototype.updateUrl=function(){var a,c,e,f,b,g;if(this.router){f=Backbone.history.fragment;if(0<(a=f.indexOf("?")))f=f.substring(0,a);a=!0;g=this.data;for(c in g)b=g[c],a?(a=!1,e="?"):e="&",f=f+e+c+"="+b;this.router.navigate(f)}return this};a.prototype.update=function(){$("tbody",this.$el).removeClass("in");this.trigger("updating");this.collection.fetch({data:this.data});return this.updateUrl()};a.prototype.refreshPagination=function(){var a,c,e,f,b,g;a=(this.data.page-1)*
this.data.size;g=a+this.collection.size();0<this.collection.size()&&a++;e=null!=this.collection.count?this.collection.count():-1;0>e?(b=c=this.data.page,f=""):(f=Math.ceil(e/this.data.size)||1,c=_.max([1,this.data.page-2-_.max([0,2+this.data.page-f])]),b=_.min([f,this.data.page+2+_.max([0,3-this.data.page])]),f=" of "+e+" entries");var j,h,i;h=_.range(c,b+1);i=[];b=0;for(j=h.length;b<j;b++)c=h[b],i.push({number:c,active:c===this.data.page&&"active"||""});$("#pagination-main",this.$el).html(this.paginationTemplate({from:a,
to:g,total:f,prevDisabled:1===this.data.page?"disabled":"",nextDisabled:g===e?"disabled":"",pages:i}));return this};a.prototype.renderData=function(){$("tbody",this.$el).html(this.dataTemplate({collection:this.collection,columns:this.columns,empty:this.empty||"No records to show"}));this.pagination&&this.refreshPagination();this.trigger("updated");$("tbody",this.$el).addClass("in");return this};a.prototype.toPage=function(a){return this.setData("page",parseInt(a.currentTarget.childNodes[0].text))};
a.prototype.prevPage=function(){return this.setData("page",this.data.page-1)};a.prototype.nextPage=function(){return this.setData("page",this.data.page+1)};a.prototype.toggleSort=function(a){var c,a=a.currentTarget;c=a.className;if(0<=c.indexOf("sorting_asc"))c="desc";else if(0<=c.indexOf("sorting"))c="asc";else return this;$("th",this.$el).removeClass("sorting_desc sorting_asc");$(a,this.$el).addClass("sorting_"+c);return this.setData("sort_col",a.abbr,"sort_dir",c)};a.prototype.applyTemplate=function(a,
c,e){null==e&&(e=12);return c&&e&&a({data:this.data,model:c,classSize:"span"+e})||""};a.prototype.render=function(){var a,c,e,b,k=this;b=3;a=6;e=3;null==this.search&&(a+=e,e=0);null==this.title?(a+=b,b=0):null==this.filters&&(b+=a,a=0);this.$el.html(this.template({empty:this.empty||"",title:this.applyTemplate(this.titleTemplate,this.title,b),search:this.applyTemplate(this.searchTemplate,this.search,e),filters:this.applyTemplate(this.filtersTemplate,this.filters,a),columns:this.applyTemplate(this.columnsTemplate,
this.columns)}));a=_.map(this.filters,function(a,d){return k.createFilter(d,a)});c=$(".filters",this.$el);_.each(a,function(a){return c.append(a.render().el)});return this.update()};a.prototype.prettyName=function(a){return a.charAt(0).toUpperCase()+a.substring(1).replace(/_(\w)/g,function(a,d){return" "+d.toUpperCase()})};a.prototype.firstOf=function(){var a,c,b;c=1<=arguments.length?__slice.call(arguments,0):[];for(b in c)if(a=c[b],null!=a)return a;return null};return a}(Backbone.View);
Filter=function(b){function a(){this.render=__bind(this.render,this);return a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.tagName="div";a.prototype.className="pull-left filterbox";a.prototype.initialize=function(){this.id=this.options.id;this.extraId=this.options.extraId;return this.setData=this.options.setData};a.prototype.render=function(){this.$el.html(this.template(this.options));return this};return a}(Backbone.View);
InputFilter=function(b){function a(){this.update=__bind(this.update,this);return a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.template=_.template('<span class="add-on"><%= name %></span><input type="text" class="filter <%= filterClass %>" value="<%= init %>"></input>');a.prototype.className="input-prepend pull-left filterbox";a.prototype.events={"change .filter":"update"};a.prototype.update=function(a){return this.extraId?this.setData(this.id,this.options.get(a.currentTarget.value),
this.extraId,this.options.getExtraId(a.currentTarget.value)):this.setData(this.id,this.options.get(a.currentTarget.value))};return a}(Filter);
ButtonFilter=function(b){function a(){this.update=__bind(this.update,this);return a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.template=_.template('<button type="button" class="filter btn <%= init == on ? "active" : "" %> <%= filterClass %>"><%= name %></button>');a.prototype.events={"click .filter":"update"};a.prototype.initialize=function(){a.__super__.initialize.apply(this,arguments);this.values=[this.options.off,this.options.on];return this.current=this.options.init===
this.options.off?0:1};a.prototype.update=function(a){$(a.currentTarget,this.$el).toggleClass("active");this.current=1-this.current;return this.setData(this.id,this.values[this.current])};return a}(Filter);
ButtonOptionFilter=function(b){function a(){this.update=__bind(this.update,this);return a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.template=_.template('<% _.each(options, function (el, i) { %>\n    <button class="btn <%= init == el.value ? "active" : "" %>" value="<%= el.value %>"><%= el.name %></button>\n<% }) %>');a.prototype.className="btn-group pull-left filterbox";a.prototype.events={"click .btn":"update"};a.prototype.initialize=function(){a.__super__.initialize.apply(this,
arguments);return this.options.options=_.map(this.options.options,function(a){var c,b;b=a;_.isArray(b)?(c=b[0],b=b[1]):_.isObject(b)?(c=a.name,b=a.value):c=a;return{name:c,value:b}})};a.prototype.update=function(a){$(".btn",this.$el).removeClass("active");$(a.currentTarget,this.$el).addClass("active");return this.setData(this.id,a.currentTarget.value)};return a}(Filter);
