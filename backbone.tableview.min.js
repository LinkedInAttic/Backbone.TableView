var __bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function c(){this.constructor=b}for(var f in a)__hasProp.call(a,f)&&(b[f]=a[f]);c.prototype=a.prototype;b.prototype=new c;b.__super__=a.prototype;return b};
Backbone.TableView=function(b){function a(){this.render=__bind(this.render,this);this.toggleSort=__bind(this.toggleSort,this);this.nextPage=__bind(this.nextPage,this);this.prevPage=__bind(this.prevPage,this);this.renderData=__bind(this.renderData,this);this.update=__bind(this.update,this);this.updateOnEnter=__bind(this.updateOnEnter,this);this.printFilter=__bind(this.printFilter,this);return a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.tagName="div";a.prototype.titleTemplate=
_.template("<h2><%= model %></h2>");a.prototype.filtersTemplate=_.template("<% _.each(model, function (filter) { %>\n    <%= filter %>\n<% }) %>");a.prototype.searchTemplate=_.template('<input type="text" class="search-query pull-right" placeholder="<%= model.detail || model %>"></input>');a.prototype.inputTemplate=_.template('<div class="input-prepend inline">\n    <span class="add-on"><%= name %></span><input id="<%= id %>" type="text" class="filter <%= className %>" value="<%= init %>"></input>\n</div>');
a.prototype.paginationTemplate=_.template('<ul class="pager">\n    <li class="pager-prev">\n        <a href="javascript:void(0)">&larr; Prev</a>\n    </li>\n    <span class="badge badge-info page">1</span>\n    <li class="pager-next">\n        <a href="javascript:void(0)">Next &rarr;</a>\n    </li>\n</ul>');a.prototype.dataTemplate=_.template('<% _.each(collection.models, function (row, i) { %>\n    <tr>\n        <% _.each(columns, function (col, name) { %>\n            <td class="<%= col.className || "" %>">\n                <%= col.draw ? col.draw(row) : row.get(name) %>\n            </td>\n        <% }) %>\n    </tr>\n<% }) %>\n<% if (collection.models.length == 0) { %>\n    <tr>\n        <td colspan="10"><%= empty %></td>\n    </tr>\n<% } %>');
a.prototype.template=_.template('<div class="row-fluid">\n    <div class="span2">\n        <%= title %>\n    </div>\n\n    <div class="controls pagination-centered span8">\n        <%= filters %>\n    </div>\n\n    <div class="span2">\n        <%= search %>\n    </div>\n</div>\n\n<table class="table table-striped table-bordered">\n    <thead>\n        <tr>\n            <% _.each(columns, function (col, key) { %>\n                <th abbr="<%= key || col %>" class="<%= !col.nosort && "sorting" %> <%= col.className || "" %>">\n                    <%= col.header || col %>\n                </th>\n            <% }) %>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td colspan="10"><%= empty %></td>\n        </tr>\n    </tbody>\n</table>\n\n<%= pagination %>');
a.prototype.events={"keypress .search-query":"updateOnEnter","change   .filter":"update","click    .pager-prev":"prevPage","click    .pager-next":"nextPage","click    th":"toggleSort"};a.prototype.initialize=function(){this.collection.on("reset",this.renderData);this.page=this.page||1;this.size=this.size||10;return this};a.prototype.printFilter=function(c,a){switch(a.type){case "input":return this.inputTemplate({name:this.capitalize(c),id:"filter"+c,init:a.init||"",className:a.className||""})}return""};
a.prototype.updateOnEnter=function(c){13===c.keyCode&&this.update();return this};a.prototype.update=function(){var c,a,b,d,e;c={};e=this.initialData;for(d in e)a=e[d],c[d]=a;e=this.filters;for(b in e)if(d=e[b],a=$("#filter"+b,this.$el))a=a.val(),c[b]=null!=d.get&&d.get(a)||a;this.search&&(c[this.search.query||"q"]=$(".search-query",this.$el).val());this.sortDir&&this.sortCol&&(c.sort_dir=this.sortDir,c.sort_col=this.sortCol);c.page=this.page;c.size=this.size;this.collection.fetch({data:c});return this};
a.prototype.capitalize=function(a){return a.charAt(0).toUpperCase()+a.substring(1).toLowerCase()};a.prototype.renderData=function(){var a;(a=$("tbody",this.$el))&&a.html(this.dataTemplate({collection:this.collection,columns:this.columns,empty:this.empty||""}));$(".page",this.$el).html(this.page);return this};a.prototype.prevPage=function(){this.page-=1;return 1>this.page?this.page=1:this.update()};a.prototype.nextPage=function(){if(this.collection.length===this.size)return this.page+=1,this.update()};
a.prototype.toggleSort=function(a){var b;b=a.currentTarget;a=b.className;if(0<=a.indexOf("sorting_desc"))this.sortDir="asc",a="sorting_asc";else if(0<=a.indexOf("sorting")||0<=a.indexOf("sorting_asc"))this.sortDir="desc",a="sorting_desc";else return this;$("th.sorting_desc, th.sorting_asc",this.$el).removeClass("sorting_desc sorting_asc");$(b,this.$el).addClass(a);this.sortCol=b.abbr;return this.update()};a.prototype.applyTemplate=function(a,b){return null!=b&&b&&a({model:b})||""};a.prototype.render=
function(){var a=this;this.$el.html(this.template({columns:this.columns,empty:this.empty||"",title:this.applyTemplate(this.titleTemplate,this.title),search:this.applyTemplate(this.searchTemplate,this.search),filters:this.applyTemplate(this.filtersTemplate,_.map(this.filters,function(b,g){return a.printFilter(g,b)})),pagination:this.applyTemplate(this.paginationTemplate,this.pagination)}));return this.update()};return a}(Backbone.View);
